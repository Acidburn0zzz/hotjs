<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>QUnit: Object Oriented</title>
<link rel="stylesheet" href="../../lib/qunit-1.11.0.css">
</head>
<body>
	<div id="qunit"></div>
	<div id="qunit-fixture"></div>
	<script src="../../lib/qunit-1.11.0.js"></script>
	<script src="../../lib/jquery-1.9.js"></script>
	<script src="../hotjs.js"></script>
	<script src="../social.js"></script>
	<script>
	
module('Network APIs');

test("Basic operations of AjaxClient APIs", function() {
	var aj = new hotjs.Social.AjaxClient();
	var msg;
	
	// async call. will not work.
	aj.config( { async: true } );
	aj.configURL( './msghub.php' );
	
	aj.sendMsg( { a : 1 } );
	msg = aj.pickMsg();
	equal( msg, false, "ajax async call will not immediately return result." );
	equal( msg.api, undefined, "ajax async call will not immediately return result." );
	
	// sync call, will work. 
	aj.config( { async: false } );

	aj.sendMsg( { a : 1 } );
	msg = aj.pickMsg();
	equal( typeof msg, "object", "ajax sync call return, pick 1 msg object" );
	equal( msg.api, "hello", "ajax sync call return api = hello" );

	aj.sendMsg( { a : 2 } );
	var msgs = aj.pickAllMsg();
	ok( msgs.length > 0, "ajax sync call return, pickAllMsg to get msgs > 0" );
	equal( msgs[0].api, "hello", "ajax sync call return api = hello" );
	
	msgs = aj.requestMsg( { a:3 } );
	ok( msgs.length > 0, "requestMsg is a sync call, return msgs > 0" );
	equal( msgs[0].api, "hello", "requestMsg is a sync call, return api = hello" );
	
	msg = aj.callAPI( "hello", { name: 'hotjs' } );
	equal( msg.name, "msghub", "call remote API by name, return remote name 'msghub'." )

	equal( aj.hello(), "msghub", "call hello(), return remote name 'msghub'." );
	
});

module('Social APIs');

test("Basic operations of Social APIs", function() {
	var user = new hotjs.Social.User();
	
	user.configURL( {
		_default_ : './msghub.php',
		hello : './msghub.php',
		registerAccount : './msghub.php'
	});
	
	var msg = user.callAPI("registerAccount", { username : 'me', password: 'abc123', email: 'me@gmail.com', cellphone:'110' });
	ok( msg != false, "call remote API registerAccount, reply with msg." );
	equal( msg.done, true, "call remote API registerAccount, reply done." );
	
	ok( user.registerAccount('me','abc123','me@gmmail.com','110'), "registerAccount() called and done." );
	
});

	</script>
</body>
</html>