<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>QUnit: Social API</title>
<link rel="stylesheet" href="../../lib/qunit-1.11.0.css">
</head>
<body>
	<div id="qunit"></div>
	<div id="qunit-fixture"></div>
	<script src="../../lib/qunit-1.11.0.js"></script>
	<script src="../../lib/jquery-1.9.js"></script>
	<script src="../hotjs.js"></script>
	<script src="../social.js"></script>
	<script>
	
module('Network APIs');

test("Basic operations of AjaxClient APIs", function() {
	var aj = new hotjs.Social.AjaxClient();
	var msg;
	
	// async call. will not work.
	//aj.config( { async: true } );
	aj.configAPI( './server/php/hello.php' );
	
	//aj.sendMsg( { a : 1 } );
	//msg = aj.pickMsg();
	//equal( msg, false, "ajax async call will not immediately return result." );
	//equal( msg.api, undefined, "ajax async call will not immediately return result." );
	
	// sync call, will work. 
	aj.config( { async: false } );

	aj.sendMsg( { a : 1 } );
	msg = aj.pickMsg();
	equal( typeof msg, "object", "ajax sync call return, pick 1 msg object" );
	equal( msg.api, "hello", "ajax sync call return api = hello" );

	aj.sendMsg( { a : 2 } );
	var msgs = aj.pickAllMsg();
	ok( msgs.length > 0, "ajax sync call return, pickAllMsg to get msgs > 0" );
	equal( msgs[0].api, "hello", "ajax sync call return api = hello" );
	
	msg = aj.requestMsg( { a:3 } );
	ok( typeof msg, "object", "requestMsg is a sync call, return msg as object." );
	equal( msg.api, "hello", "requestMsg is a sync call, return msg.api = hello" );
	
	msg = aj.callAPI( "hello", { name: 'hotjs' } );
	equal( msg.name, "msghub", "call remote API by name, return remote name 'msghub'." )

	equal( aj.hello(), "msghub", "call hello(), return remote name 'msghub'." );
});

module('Social APIs');

test("Basic operations of Social APIs", function() {
	equal( typeof [], "object", "typeof [] is object.");
	ok( Array.isArray( [] ), "Array.isArray([]) == true");
	equal( "", false, "empty string is false." );

	var user = new hotjs.Social.User();

	user.configAPI( {
		_default_ : './server/php/hello.php',
		registerAccount : './server/php/user.php'
	});
	equal( user.urls["_default_"], './server/php/hello.php', "config url locally.");
	equal( user.urls["registerAccount"], './server/php/user.php', "config url locally.");

	// load API from remote inf file. 
	var ret = user.loadAPI( "./server/py_user.inf", "user", 1.05 );
	equal( ret, true, "Load API definition from server inf." );
	
	user.onMsgParse = function(msg) {
		//console.log( msg );
		//if( msg.api == "say" ) alert( msg.who + " say: " + msg.what );
	};
	
	ok( user.login("zhang3", "abc123", "Gomoku", 1.0, 5000), "login to server." );

	
});

	</script>
</body>
</html>