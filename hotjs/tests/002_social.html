<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>QUnit: Social API</title>
<link rel="stylesheet" href="../../lib/qunit-1.11.0.css">
</head>
<body>
	<div id="qunit"></div>
	<div id="qunit-fixture"></div>
	<script src="../../lib/qunit-1.11.0.js"></script>
	<script src="../../lib/jquery-1.9.js"></script>
	<script src="../hotjs.js"></script>
	<script src="../social.js"></script>
	<script>
	
module('Network APIs');

test("Basic operations of AjaxClient APIs", function() {

	equal( typeof [], "object", "typeof [] is object.");
	ok( Array.isArray( [] ), "Array.isArray([]) == true");
	equal( "", false, "empty string is false." );

	var aj = new hotjs.Social.AjaxClient();
	var msg;

	aj.configAPI( './server/php/hello.php' );
	equal( aj.settings.url, './server/php/hello.php', "config url locally.");

	// async call 
	aj.onMsgParse = function( m ) {
		console.log( m );
	};
	aj.postMsg( { a : 1 } );
	
	aj.configAPI( {
		_default_ : './server/php/hello.php',
		hello : './server/php/hello.php',
		registerAccount : './server/php/user.php'
	});
	equal( aj.settings.url, './server/php/hello.php', "config url locally.");
	equal( aj.urls["_default_"], './server/php/hello.php', "config url locally.");
	equal( aj.urls["hello"], './server/php/hello.php', "config url locally.");
	equal( aj.urls["registerAccount"], './server/php/user.php', "config url locally.");

	// sync call
	msg = aj.requestMsg( { a:3 } );
	ok( typeof msg, "object", "requestMsg is a sync call, return msg as object." );
	equal( msg.api, "hello", "requestMsg is a sync call, return msg.api = hello" );
	
	// call remote API 
	msg = aj.callAPI( "hello", { name: 'hotjs' } );
	equal( msg.name, "msghub", "call remote API by name, return remote name 'msghub'." )

	// call local API 
	equal( aj.hello(), "msghub", "call hello(), return remote name 'msghub'." );

});

module('Social APIs');

test("Basic operations of Social APIs", function() {

	var user = new hotjs.Social.User();

	// load API from remote inf file. 
	var ret = user.loadAPI( "./server/py_user.inf", "user", 1.05 );
	equal( ret, true, "Load API definition from server inf." );
	
	user.onMsgParse = function(msg) {
		//console.log( msg );
		//if( msg.api == "say" ) alert( msg.who + " say: " + msg.what );
	};
	
	ok( user.login("zhang3", "abc123", "Gomoku", 1.0, 5000), "login to server, start heartbeat." );
	
});

	</script>
</body>
</html>