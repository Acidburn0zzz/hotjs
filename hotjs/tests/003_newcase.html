<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>QUnit: New test cases</title>
<link rel="stylesheet" href="lib/qunit-1.11.0.css">
</head>
<body>
<div id="qunit"></div>
<div id="qunit-fixture"></div>

<script src="lib/qunit-1.11.0.js"></script>
<script src="lib/jquery-1.9.js"></script>
<script src="../hotjs.js"></script>
<script>

hotjs.require('../resource.js');
hotjs.require('../math.js');
hotjs.require('../ai.js');
hotjs.require('../social.js');
hotjs.require('../i18n.js');
hotjs.require('../domui.js');

module('New Module');
test('UT of New Module', function(){
	
	ok( true, navigator.userAgent );
	
	ok( true, hotjs.agentType + ' ' + hotjs.agentVersion )
	
	ok( true, '__FILE__ = ' + hotjs.this_file() );
	
	ok( true, hotjs.getDirPath( hotjs.this_file() ) );
	
	ok( true, 'hello, hotjs.AI.');
	
	var a = { 'test': 1, 1001: 2 };
	equal( a[ 'test' ], 1, 'use string as key of mapping' );
	equal( a[ 1001 ], 2, 'use integer as key of mapping' );

	var s1 = document.getElementsByTagName('script').length;
	resources.unload('../domui.js');
	var s2 = document.getElementsByTagName('script').length;
	equal( (s2 +1), s1, 'unload domui.js, script tag removed. ' + s1 + ' -> ' + s2 );
	
	var ss = document.getElementsByTagName('script');
	var urls = [];
	for(var i=0; i<ss.length; i++ ) {
		urls.push( ss[i].src );
	}
	resources.unload( urls );
	equal( ss.length, 1, 'all script unloaded, will error occur?' );
	
	equal( hotjs.getDirPath('../../test.js'), '../..', 'getDirPath' );
	str = hotjs.getAbsPath('../../../test.js', '../../hello.js');
	equal( str, '../test.js', 'getAbsPath' );
	
	ok( typeof hotjs.require == 'function', 'hotjs.require is function.');
	ok( typeof requireScripts == 'function', 'requireScripts fallback defined.');
	
});

module('DOM UI');
test('DOM UI Components', function(){
	ok( true, 'dom UI');
	
	hotjs.domUI.popupDialog( 'Hello', 'Nice to meet you.' );

	hotjs.domUI.popupDialog('Hello', 'Are you sure?', {
			'ok' : function() {
				alert('ok');
				return true;
			},
			'cancel' : function() {
				alert('cancel');
				return false;
			}
		}, {
			'color' : 'blue',
			'background' : '#cccccc',
			'top' : '100px',
			'padding' : '5px'
		});

});

module('Local Storage');
test('local storage', function(){
	
	ok( typeof(Storage)!=="undefined", 'Yes! localStorage and sessionStorage support!' );

	if (localStorage.clickcount) {
		localStorage.clickcount = Number(localStorage.clickcount) + 1;
		localStorage.clickcount = Number(localStorage.clickcount) + 1;
	} else {
		localStorage.clickcount = 1;
	}
	
	console.log( localStorage.clickcount );
	console.log( typeof localStorage.clickcount );

	console.log( localStorage );
});

module('Social APIs');
test("Basic operations of Social APIs", function() {

	var user = new hotjs.Social.User();

	ok(true, 'hello!');

	// load API from remote inf file. 
	//var ret = user.loadAPI( "./sns/user.inf", "user", 1.05 );
	//equal( ret, true, "Load API definition from sns inf." );

	user.onMsgParse = function(msg) {
		//console.log( msg );
		//if( msg.api == "say" ) alert( msg.who + " say: " + msg.what );
	};

	//ok( user.login("zhang3", "abc123", "Gomoku", 1.0, 5000), "login to sns, start heartbeat." );

});

</script>
</body>
</html>
