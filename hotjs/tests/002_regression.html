<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="Expires" CONTENT="0">
<meta http-equiv="Cache-Control" CONTENT="no-cache">
<meta http-equiv="Pragma" CONTENT="no-cache">
<title>QUnit: All regression test cases</title>
<link rel="stylesheet" href="lib/qunit-1.11.0.css">
</head>
<body>

<div id="qunit"></div>
<div id="qunit-fixture"></div>

<script src="lib/qunit-1.11.0.js"></script>
<script src="lib/jquery-1.9.js"></script>

<script src="../hotjs.js"></script>
<script src="../math.js"></script>
<script src="../canvas.js"></script>
<script src="../physics.js"></script>
<script src="../resource.js"></script>
<script src="../util.js"></script>
<script src='../ai.js'></script>
<script src="../social.js"></script>
<script src="../i18n.js"></script>


<script>
	
module('Javascript core extension');

test("Array indexOf", function() {
	var olist = ['a', 'b', 'c', 'd', 'e'];
	equal(olist.indexOf('a'), 0, 'expected: 0');
	equal(olist.indexOf('c'), 2, 'expected: 2');
	equal(olist.indexOf('a',3), -1, 'expected: -1, if search after that.');
	equal(olist.indexOf('x'), -1, 'expected: -1, if not found.');
});

module('Object oriented');

test("Object inherit and override", function() {
	// test object inherit 
	var F1 = function(x){
		this.v1 = x;
	};

	F1.prototype = {
		f1: function(){
			return 'f1';
		}
	};
	
	var F2 = function(x,y){
		hotjs.base(this,x);
		this.v2 = y;
	};
	
	hotjs.inherit(F2, F1, {
		f2 : function() {
			return 'f2';
		}
	});
	
	var F3 = function(x,y,z){
		hotjs.base(this,x,y);
		this.v3 = z;
	}
	
	hotjs.inherit(F3, F2, {
		f3 : function(){
			return 'f3';
		}
	});
	
	var o1 = new F1(1);
	var o2 = new F2(2,3);
	var o3 = new F3(4,5,6);
	
	equal(o1.f1(), 'f1', 'expected value: f1');
	equal(o1.v1, 1, 'expected value: 1');
	
	equal(o2.f1, o1.f1, 'o2.f1 == o1.f1');
	equal(o2.f2(), 'f2', 'expected value: f2');
	equal(o2.v1, 2, 'expected value: 2');
	equal(o2.v2, 3, 'expected value: 3');

	equal(o3.f1, o1.f1, 'o3.f1 == o1.f1');
	equal(o3.f2, o2.f2, 'o3.f2 == o2.f2');
	equal(o3.f3(), 'f3', 'expected value: f3');
	equal(o3.v1, 4, 'expected value: 4');
	equal(o3.v2, 5, 'expected value: 5');
	equal(o3.v3, 6, 'expected value: 6');
	
	equal(F1.prototype.f1, F2.prototype.f1, "F1.f1 == F2.f1");
	equal(F1.prototype.f1, F3.prototype.f1, "F1.f1 == F3.f1");
	
});

module('Random');

test("Random functions", function() {
	// test random 
	ok( hotjs.Random.Float(10,20) >= 10, 'random(10,20) >= 10');
	ok( hotjs.Random.Float(10,20) < 20, 'random(10,20) < 20');
	ok( hotjs.Random.Integer(10,20) >= 10, 'random(10,20) >= 10');
	ok( hotjs.Random.Integer(10,20) < 20, 'random(10,20) < 20');

});

module('Vector');

test("Vector functions", function() {
	// test Vector operation 
	notEqual(hotjs.Vector.copy([1,2]), [1,2], 'vector copy  return different object.');
	deepEqual(hotjs.Vector.copy([1,2]), [1,2], 'vector copy value should be same, if use deepEqual compare.');
	deepEqual(hotjs.Vector.vert([1,2]), [2,-1], 'vector vert fails.');
	deepEqual(hotjs.Vector.add([1,2],[3,4]), [4,6], 'vector add fails.');
	deepEqual(hotjs.Vector.sub([1,2],[3,4]), [-2,-2], 'vector sub fails.');
	deepEqual(hotjs.Vector.mul([1,2],3), [3,6], 'vector sub fails.');
	deepEqual(hotjs.Vector.scale([1,2],[3,4]), [3,8], 'vector scale fails.');
	deepEqual(hotjs.Vector.scaleDown([1,2],[2,4]), [0.5,0.5], 'vector scale down fails.');
	equal(hotjs.Vector.getLength([3,4]), 5, '[3,4] length is 5');
	ok(hotjs.Vector.inRect([3,4], [0,0,3.1,4.1]), '[3,4] in rect [0,0,3.1,4.1]');
	ok(hotjs.Vector.inRect([3,4], [3,4,0.1,0.1]), '[3,4] in rect [3,4,0.1,0.1]');
	ok(hotjs.Vector.inCircle([0,0],[3,4],5), '[3,4] are in range of [0,0] if given r = 5');
	
});

module('HashMap');

test("HashMap class", function() {
	// test HashMap 
	var hm = new hotjs.HashMap();
	ok( hm.isEmpty(), 'hashmap is empty after created.');
	hm.put('k1', 100);
	hm.put('k2', 200);
	hm.put('k3', 300);
	equal( hm.size(), 3, 'after put 3 values, size is 3.');
	equal( hm.get('k1'), 100, 'get value of k1 == 100');
	hm.remove('k2');
	equal( hm.size(), 2, 'after remove 1 value, size is 2.');
	var ks = hm.keys();
	for( var i=0; i<hm.size(); i++ ) {
		ok( hm.containsValue( hm.get(ks[i]) ), 'values return by key are contained.' );
	}
	hm.clear();
	ok( hm.isEmpty(), 'hashmap is empty after clear() called.');
});

module('Resource');

test("Resource preload", function() {
	resources.onLoading( function(url,n,all) {
		var per = Math.round( n * 100 / all );
		var d = document.getElementById('loading_msg');
		if( d ) {
			d.innerHTML += '<br>' + url.substring(url.lastIndexOf('/')+1) + ' loaded. (' + per + '%)'; 
		}
		var d = document.getElementById('loading_bar');
		if( d ) {
			d.style.width = 300 * per / 100 + 'px';
			d.innerHTML = per + "%";
		}
	});
	resources.onError(function(url){
		var d = document.getElementById('loading_msg');
		if( d ) {
			d.innerHTML += '<br>' + url.substring(url.lastIndexOf('/')+1) + ' not found.'; 
		}
	});
	resources.onReady(function(){
		var d = document.getElementById('loading_msg');
		if( d ) {
			d.innerHTML += '<br>Resource loaded.'; 
		}
		d = document.getElementById('res_loading_msg_win');
		//d = document.getElementById('loading_img');
		if( d ) {
			d.setAttribute('style', 'display:none');
		}
	});
	function showLoadingDialog(){
		var w = window.innerWidth, h = window.innerHeight;
		var tw = 300, th = 300;
		var x = (w-tw)/2, y = (h-th)/2;
		var d = document.createElement('div');
		d.setAttribute('id', 'res_loading_msg_win');
		d.setAttribute('style', 'width:'+tw+'px;text-align:center;background:white;padding:10px;font-family:Verdana,Geneva,sans-serif;font-size:9pt;border:solid black 1px;display:solid;position:absolute;left:' +x + 'px;top:' +y+'px;'  );
		document.body.appendChild( d );
		d.innerHTML = "<b>Loading Resource</b><br>";
		d.innerHTML += "<br><div id='loading_msg' style='text-align:left;overflow-y:scroll;overflow-x:hidden;width:300px;height:140px;border:solid silver 1px;'>Loading resource:</div>";
		d.innerHTML += "<br><div id='loading_bar' style='text-align:center;width:0px;height:16px;background:#008800;color:white;border:solid silver 1px;'></div>";
		d.innerHTML += "<br><img id='loading_img' src='data:image/gif;base64,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'/>";
		d.innerHTML += "<br><input type='button' value='OK' onClick=\"document.getElementById('res_loading_msg_win').setAttribute('style', 'display:none');\"/>";
	}
	showLoadingDialog();
	resources.load([
		'http://img.talkandroid.com/uploads/2011/07/sony-ericsson-logo.jpg',
		'http://media.glassdoor.com/m/3472/ericsson-worldwide-office.jpg',
		'http://www.stephaniequinn.com/Music/Jazz%20Rag%20Ensemble%20-%2010.mp3',
		'http://blogs-images.forbes.com/tomiogeron/files/2012/01/ericsson1.jpg',
		'http://biztech.gr/sites/default/files/field/image/ericsson.jpg' 
		]);

	ok( true, 'resource loaded.');
});

module('Math Matrix');

test('Math matrix functions', function(){
	var m1 = [[1,2,3],
	          [4,5,6],
	          [7,8,9]];
	var m2 = [[1,4,7],
	          [2,5,8],
	          [3,6,9]];
	var m3 = [[2,6,10],
	          [6,10,14],
	          [10,14,18]];
	
	// Math Matrix functions
	ok( hotjs.Matrix.isEqual( hotjs.Matrix.copy(m1), m1), 'copy matrix');
	ok( hotjs.Matrix.isEqual( hotjs.Matrix.add(m1,m2), m3), 'add matrix');
	ok( hotjs.Matrix.isEqual( hotjs.Matrix.sub(m3,m1), m2), 'sub matrix');

	var mtx_str = '1000|0100|0010|0001';
	var mtx = hotjs.Matrix.fromString( mtx_str, '', '|' );
	
	var str = hotjs.Matrix.toString( mtx, '', '|' );
	equal( str, mtx_str, mtx_str + 'fromString -> toString -> ' + mtx_str );
	ok( true, mtx_str + ' -> fromString -> toString -> ' + hotjs.Matrix.toString( mtx, ',', '|' ) );

	var m4 = hotjs.Matrix.create(4,4,1);
	ok( true, 'create matrix with 1 -> ' + hotjs.Matrix.toString( m4, '','|' ) );
	
	m4 = hotjs.Matrix.setValue(m4, 2);
	ok( true, 'set matrix with 2 -> ' + hotjs.Matrix.toString( m4, '','|' ) );
	
	var m4 = hotjs.Matrix.convert( mtx, window.Number );
	ok( true, 'convert to number: ' + hotjs.Matrix.toString( m3, ',', '|') );
	
	ok( hotjs.Matrix.isEqual( hotjs.Matrix.inverse(m1), m2), 'inverse matrix');
});


module('AI Matrix');

test('hotjs.AI.Matrix', function(){
	var m1 = [[1,2,3],
	          [4,5,6],
	          [7,8,9]];
	var m2 = [[1,4,7],
	          [2,5,8],
	          [3,6,9]];
	var m3 = [[2,6,10],
	          [6,10,14],
	          [10,14,18]];

	// AI.Matrix class
	var mtx1 = new hotjs.AI.Matrix();
	mtx1.importData( m1 );
	ok( hotjs.Matrix.isEqual( mtx1.data, m1), 'import data');
	
	var mtx2 = mtx1.clone();
	ok( hotjs.Matrix.isEqual( mtx1.data, mtx2.data), 'clone matrix');
	
	mtx2.copy( mtx1 );
	ok( hotjs.Matrix.isEqual( mtx1.data, mtx2.data), 'copy matrix');
	
	mtx2.exchangeValue(2,4).exchangeValue(3,7).exchangeValue(6,8);
	ok( hotjs.Matrix.isEqual( mtx2.data, m2), 'exchangeValue');
	
	var m4 = mtx1.getPosByValue(2);
	ok( hotjs.Matrix.isEqual( m4, [[1,0]]), 'getPosByValue, return one');
	ok( hotjs.Matrix.isEqual( mtx1.getPosByValue(7), [[0,2]]), 'getPosByValue, return one');
	
	m4 = mtx2.importData(m3).getPosByValue(10);
	m5 = [[2,0],[1,1],[0,2]];
	ok( hotjs.Matrix.isEqual( m4, m5), 'getPosByValue, return several');
	
	var str = mtx1.toString(',', '|');
	equal( str, '1,2,3|4,5,6|7,8,9', 'matrix to string with seperators.')
	
	// now, start transit 
	mtx2 = mtx1.clone();
	ok( true, 'clone, mapping -> ' + hotjs.Matrix.toString(mtx2.getMapping(),';','|') );

	mtx2 = mtx1.clone().inverse();
	str = mtx2.toString();
	equal( str, '147|258|369', 'inverse -> ' + str)
	ok( true, 'inverse, mapping -> ' + hotjs.Matrix.toString(mtx2.getMapping(),';','|') );
	
	mtx2 = mtx1.clone().flipLeftRight();
	str = mtx2.toString(',', '|');
	m6x = [[3,2,1],[6,5,4],[9,8,7]];
	str2 = hotjs.Matrix.toString(m6x, ',', '|');
	equal( str, str2, 'flipLeftRight -> ' + str2);
	ok( true, 'flipLeftRight, mapping -> ' + hotjs.Matrix.toString(mtx2.getMapping(),';','|') );
	
	mtx2 = mtx1.clone().flipUpDown();
	ok( true, 'flipUpDown -> ' + hotjs.Matrix.toString(mtx2.getData()) );
	ok( true, 'flipUpDown, mapping -> ' + hotjs.Matrix.toString(mtx2.getMapping(),';','|') );

	mtx2 = mtx1.clone().leanRight45();
	str = mtx2.toString(',', '|');
	m6x = [[1],[4,2],[7,5,3],[8,6],[9]];
	str2 = hotjs.Matrix.toString(m6x, ',', '|');
	equal( str, str2, 'leanRight45 -> ' + str2);
	ok( true, 'leanRight45, mapping -> ' + hotjs.Matrix.toString(mtx2.getMapping(),';','|') );
	
	mtx2 = mtx1.clone().leanLeft45();
	str = mtx2.toString(',', '|');
	m6x = [[3],[2,6],[1,5,9],[4,8],[7]];
	str2 = hotjs.Matrix.toString(m6x, ',', '|');
	equal( str, str2, 'leanLeft -> ' + str2);
	ok( true, 'leanLeft45, mapping -> ' + hotjs.Matrix.toString(mtx2.getMapping(),';','|') );
	
	mtx2 = mtx1.clone().flipLeftRight().inverse().leanRight45();
	str = mtx2.toString(',','|');
	equal( str, str2, 'leanLeft workaround -> ' + str2);
	ok( true, 'leanLeft45 workarround, mapping -> ' + hotjs.Matrix.toString(mtx2.getMapping(),';','|') );
	
});


module('AjaxClient');

test("Basic AjaxClient APIs", function() {

	equal( typeof [], "object", "typeof [] is object.");
	ok( Array.isArray( [] ), "Array.isArray([]) == true");
	equal( "", false, "empty string is false." );

	var aj = new hotjs.Social.AjaxClient();
	var msg;

	aj.configAPI( './sns/hello.php' );
	equal( aj.settings.url, './sns/hello.php', "config url locally.");

	// async call 
	aj.onMsgParse = function( m ) {
		console.log( m );
	};
	aj.postMsg( { a : 1 } );
	
	aj.configAPI( {
		_default_ : './sns/hello.php',
		hello : './sns/hello.php'
	});
	equal( aj.settings.url, './sns/hello.php', "config url locally.");
	equal( aj.urls["_default_"], './sns/hello.php', "config url locally.");
	equal( aj.urls["hello"], './sns/hello.php', "config url locally.");

	// sync call
	msg = aj.requestMsg( { a:3 } );
	ok( typeof msg, "object", "requestMsg is a sync call, return msg as object." );
	equal( msg.api, "hello", "requestMsg is a sync call, return msg.api = hello" );
	
	// call remote API 
	msg = aj.callAPI( "hello", { name: 'hotjs' } );
	equal( msg.name, "msghub", "call remote API by name, return remote name 'msghub'." )

	// call local API 
	equal( aj.hello(), "msghub", "call hello(), return remote name 'msghub'." );

	aj.loadAPI( './sns/hello.inf' );
	equal( aj.settings.url, './sns/hello.php', "load API from remote.");
	equal( aj.urls["_default_"], './sns/hello.php', "load API from remote.");
	equal( aj.urls["hello"], './sns/hello.php', "load API from remote.");
	
});

module('I18N');
test('I18N multi-language APIs', function(){
	ok( true, 'current language: ' + hotjs.i18n.getLang() );

	hotjs.i18n.put( hotjs.i18n.getLang(), {
		mygod: 'my god',
		lady: {
			gaga: 'lady gaga',
			papa: 'lady papa'
		}
	})
	
	equal( hotjs.i18n.get('mygod'), 'my god', 'hotjs.i18n.get(\'mygod\')');
	equal( hotjs.i18n.get('lady.gaga'), 'lady gaga', 'hotjs.i18n.get(\'lady.gaga\')');
});


	</script>
</body>
</html>
