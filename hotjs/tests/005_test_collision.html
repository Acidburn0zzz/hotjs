<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Expires" CONTENT="0">
<meta http-equiv="Cache-Control" CONTENT="no-cache">
<meta http-equiv="Pragma" CONTENT="no-cache">
<meta name="viewport"
	content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
<script type="text/javascript" src="../resource.js"></script>
<script type="text/javascript" src="../sprite.js"></script>
<script type="text/javascript" src="../hotjs.js"></script>
<script type="text/javascript" src="../math.js"></script>
<script type="text/javascript" src="../physics.js"></script>
<style type="text/css">
html, body {
	width: 100%;
	height: 100%;
	overflow: hidden;
	margin: 0;
	padding: 0;
}
div#buttons {
	position: absolute;
	left: 480px;
	top: 20px;
}
input {
	position: absolute;
	right: 0px;
}
</style>
</head>
<body>
<div id="view1" style="display: inline-block; margin: 0px;"></div>
<div id="buttons">
	<input type="button" value="Add 1 Ball" onClick="add_ball();"/><br/><br/>
	<input type="button" value="Remove 1 Ball" onClick="remove_ball();"/><br/><br/>
	<input type="button" value="Kick Ball #1" onClick="kick_ball(0);"/><br/><br/>
	<input type="button" value="Kick Ball #2" onClick="kick_ball(1);"/><br/><br/>
</div>
<script>
	
var DemoRoom = function(){
	hotjs.base(this);
	this.formula = false;
};

hotjs.inherit(DemoRoom, hotjs.Physics.Scene, {
	showFormula : function(f) {
		this.formula = f;
		return this;
	},
	draw : function(c) {
		DemoRoom.supClass.draw.call(this, c);

		if( this.formula ) {
			c.save();
			c.translate( this.size[0] / 2, this.size[1] / 2);
			
			var v1 = [40,-70]; // velocity
			var v2 = [100,-50]; // 2 ball center line
			var v3 = [v2[1],-v2[0]]; // tangent
			var v = hotjs.Math.vectorProject(v1, v2);
			
			var pos1 = hotjs.Math.vectorMul(v2, 0.4);
			var pos2 = hotjs.Math.vectorMul(v2, -0.3);
			c.strokeStyle = "black";
			c.beginPath();
			c.arc(pos1[0], pos1[1], hotjs.Math.vectorLength(pos1), 0, Math.PI * 2);
			c.stroke();
			c.beginPath();
			c.arc(pos2[0], pos2[1], hotjs.Math.vectorLength(pos2), 0, Math.PI * 2);
			c.stroke();
			
			var drawLine = function(c, color, line) {
				c.beginPath();
				c.strokeStyle = color;

				var v1 = line[0], v2 = line[1];
				c.moveTo(v1[0], v1[1]);
				c.lineTo(v2[0], v2[1]);

				c.stroke();
			};

			drawLine(c, "gray", [[-v2[0],-v2[1]], v2]);
			drawLine(c, "gray", [[-v3[0],-v3[1]], v3]);
			c.lineWidth = 3;
			drawLine(c, "blue", [[0,0], v1]);
			c.fillText("momentum", v1[0], v1[1]-5);
			drawLine(c, "red", [v1, v]);
			drawLine(c, "red", [[0,0], v]);
			
			c.restore();
		}
	}		
});

var balls = [];
var add_ball = function(){};
var remove_ball = function(){};

resources.load([
    		'redball.png',
    		'smallbird.png'
    	]);
        	
resources.onReady(function() {
	var view1 = (new hotjs.View()).setContainer('view1').setSize(WIDTH,HEIGHT).showFPS(true);

	var room = (new DemoRoom()).setSize(WIDTH, HEIGHT).setColor("blue");
	room.showGrid(true).showFormula(true);
	view1.addScene(room);
	
	add_ball = function() {
		r = hotjs.Math.randomInteger(30,90);
		b = new hotjs.Physics.Ball();
		b.setImage(resources.get('redball.png')).setSize(r,r).setDensity(1);
		
		var x = WIDTH/5 + Math.random() * 100;
		b.setPos(x + b.size[0]/2,HEIGHT-b.size[1]/2).setVelocity(0,0).setAccel(0,0);
		
		room.addNode(b);
		balls.push(b);			
	};
	
	remove_ball = function() {
		if(balls.length > 0) {
			room.removeNode( balls.pop() );
		}
	};

	for( var i=0; i<2; i++ ) {
		add_ball();
	}		
	
	var app = (new hotjs.App()).addView(view1).start();
});

function kick_ball(i){
	var b = balls[i];
	if( b != undefined ) {
		var vx = Math.random() * 40 - 20;  // range [-10,10] 
		var vy = -10 - Math.random() * 10; // range [-10, -20] 
		b.setVelocity(vx,vy);
	}
}	
</script>
</body>

</html>
