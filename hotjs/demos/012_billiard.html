<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Expires" CONTENT="0">
<meta http-equiv="Cache-Control" CONTENT="no-cache">
<meta http-equiv="Pragma" CONTENT="no-cache">
<meta name="viewport"
	content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
<script type="text/javascript" src="../resource.js"></script>
<script type="text/javascript" src="../sprite.js"></script>
<script type="text/javascript" src="../hotjs.js"></script>
<script type="text/javascript" src="../math.js"></script>
<script type="text/javascript" src="../physics.js"></script>
<script type="text/javascript" src="../util.js"></script>
<style type="text/css">
html, body {
	width: 100%;
	height: 100%;
	overflow: hidden;
	margin: 0;
	padding: 0;
}
div#mainView {
	display: inline-block;
	border: solid green 0px;
	margin: 0px;
	padding: 0px;
}
div#btn_zoom {
	display: inline-block;
	position: absolute;
	border: solid green 1px;
	margin: 0px;
	padding: 0px;
	top: 10px;
	right: 10px;
	background-color: #eeeeee;
}
div#btn_act {
	display: inline-block;
	position: absolute;
	border: solid green 1px;
	margin: 0px;
	padding: 0px;
	top: 50px;
	right: 10px;
	background-color: #eeeeee;
}
input.act {
	right: 0px;
}
</style>
</head>
<body>
<div>
<div id="mainView"></div>
<div id="btn_zoom">
<input type='button' value='?' onClick='viewX.showFPS();'/>
<input type='button' value='~' onClick='viewX.showFormula().benchFPS(1,300,true);'/>
<input type='button' value='bg' onClick='pool.showBgImg();'/>
<input type='button' value='#' onClick='pool.showGrid();'/>
<input class='act' type="button" value="new game" onClick="reset_game();"/>
<input class='act' type="button" value="shoot!" onClick="kick_ball(0);"/>
</div>
</div>
<script>



var balls = [];
var reset_game = function(){};
var remove_ball = function(){};

var viewX;
var table;
var pool;

resources.load([
    		'img/balls.png',
    		'img/billiardpole.png',
    		'img/billiardtable.jpg'
    	]);
        	
resources.onReady(function() {
	var w = window.innerWidth, h = window.innerHeight;
	
	var v = document.getElementById('mainView');
	v.style.width = w;
	v.style.height = h;

	viewX = (new hotjs.Util.BenchLab())
		.setContainer('mainView')
		.setSize(w,h)
		.setInfoPos(50,50)
		.showFormula(false)
		.showFPS(false);

	var bgW = 1024, bgH = 576;
	var holes = [ [34,40, 45,45],
	              [34,bgH-40-45, 45,45],
	              [bgW-34-45,40, 45,45],
	              [bgW-34-45,bgH-40-45, 45,45],
	              [512-25,24, 50,40],
	              [512-25,bgH-24-40, 50,40]
	             ];
	var fx = w / bgW, fy = h / bgH;

	var marginX = 60 * fx, marginY = 64 * fy;
	pool = (new hotjs.Physics.Scene())
		.setSize(w, h)
		.setColor("blue").showGrid(false)
		.setImage(resources.get('img/billiardtable.jpg')).showBgImg(true)
		.setRestitution(0.8)
		.setGravity(0)
		.addTo( viewX )
		;

	pool.setBoundary(marginX, marginY, w - marginX *2, h - marginY * 2);
	for( var i=0; i<holes.length; i++ ) {
		var r = holes[i];
		pool.addHole( r[0]*fx, r[1]*fy, r[2]*fx, r[3]*fy );
	}
	
	reset_game = function() {
		pool.removeAll();
		balls.length = 0;
		
		var r = 22 * fx;
		var x0 = 710 * fx, y0 = pool.height()/2 - r/2;
		
		for( var i=0; i<5; i++ ) {
			for( var j=0; j<=i; j++ ) {
				x = x0 + i * r * 0.866;
				y = y0 + j * r - i * 0.5 * r;
				b = new hotjs.Physics.Ball();
				b.setImage( resources.get('img/balls.png'), [42,0,42,42] )
				 	.setDensity(hotjs.Physics.Constant.WOOD_DENSITY)
				 	.setRestitution(0.9)
				 	.setSize(r,r)
				 	.setPos(x,y)
				 	.setVelocity(0,0)
				 	.setAccel(0,0)
				 	.setDraggable(true).setMoveable(true)
					.addTo( pool );
			}
		}
		
		x = 282 * fx - r/2, y = pool.height()/2 - r/2;
		b = new hotjs.Physics.Ball();
		b.setImage( resources.get('img/balls.png'), [0,0,42,42] )
		 	.setDensity(hotjs.Physics.Constant.WOOD_DENSITY)
		 	.setRestitution(0.9)
		 	.setSize(r,r)
		 	.setPos(x,y)
		 	.setVelocity(0,0).setAccel(0,0)
		 	.setDraggable(true).setMoveable(true)
			.addTo( pool );
		
		balls.push(b);
	}
	
	reset_game();
	
	var app = (new hotjs.App()).addNode( viewX ).start();
});

function kick_ball(i){
	var b = balls[i];
	if( b != undefined ) {
		var vx = pool.width() * hotjs.Random.Float(0.03, 0.1);   
		var vy = 0; //- Math.random() * pool.height() * 0.1;
		b.setVelocity(vx,vy);
	}
}
</script>
</body>

</html>
